# 任务清单 - 供应链订货系统

## 阶段一：基础架构与认证（第1-2周）

### 任务1.1：项目初始化
- [ ] 创建 Nest.js 后端项目，配置 TypeScript
- [ ] 创建 Vue 3 + Element Plus Web 前端项目
- [ ] 创建 uni-app 移动端项目
- [ ] 配置 MySQL 数据库连接
- [ ] 配置 Redis 缓存连接
- [ ] 配置阿里云 OSS 文件存储
- [ ] 设置代码规范（ESLint、Prettier）
- [ ] 配置 CI/CD 流水线

### 任务1.2：数据库设计与初始化
- [ ] 创建用户表 (user)、管理员表 (admin)
- [ ] 创建门店表 (store)、供应商表 (supplier)
- [ ] 创建物料分类表 (category)、物料表 (material)
- [ ] 创建物料SKU表 (material_sku)、供应商物料价格表 (supplier_material)
- [ ] 创建订单表 (order)、订单明细表 (order_item)
- [ ] 创建加价规则表 (markup_rule)、起订量规则表 (min_order_rule)
- [ ] 创建配送区域表 (delivery_area)
- [ ] 编写数据库迁移脚本

### 任务1.3：用户认证模块（需求1）
- [ ] 实现账号密码登录接口
- [ ] 实现 JWT Token 生成与验证
- [ ] 实现 Token 刷新机制
- [ ] 实现多角色用户的角色选择逻辑
- [ ] 实现角色切换接口
- [ ] 编写认证中间件和单元测试

### 任务1.4：权限管理模块（需求2）
- [ ] 实现权限常量定义和主管理员初始化
- [ ] 实现子管理员创建和权限分配接口
- [ ] 实现权限校验中间件和敏感权限保护
- [ ] 编写权限装饰器和单元测试

---

## 阶段二：物料与供应商管理（第3-4周）

### 任务2.1：物料管理模块（需求11）
- [ ] 实现物料分类 CRUD 接口和层级管理
- [ ] 实现物料基础信息和 SKU CRUD 接口
- [ ] 实现物料与供应商关联、供应商报价管理
- [ ] 实现批量导入/导出功能

### 任务2.2：产品审核模块（需求11）
- [ ] 实现待审核产品列表接口
- [ ] 实现产品审核通过接口（支持修改名称、品牌、规格、价格、图片）
- [ ] 实现产品审核驳回接口和批量审核
- [ ] 实现审核历史记录

### 任务2.3：素材库模块（需求12）
- [ ] 实现图片上传接口（OSS）和分类管理
- [ ] 实现图片标签管理和自动匹配算法
- [ ] 实现手动匹配接口和匹配规则配置

### 任务2.4：供应商管理模块（需求9）
- [ ] 实现供应商 CRUD 接口和显示名称设置
- [ ] 实现供应商启用/禁用、对接模式和配送模式配置
- [ ] 实现平台代管功能和代管操作日志
- [ ] 实现批量导入供应商物料价格

### 任务2.5：供应商配送设置模块（需求10）
- [ ] 实现起送价、配送日、配送区域设置接口
- [ ] 实现配送日期计算逻辑
- [ ] 实现起订量规则 CRUD 接口（按商品/SKU）
- [ ] 实现配送设置和起订量规则审核流程
- [ ] 实现变更历史记录

---

## 阶段三：门店与购物车（第5-6周）

### 任务3.1：门店管理模块（需求17）
- [ ] 实现门店 CRUD 接口和分组管理
- [ ] 实现门店加价开关和 Webhook 配置
- [ ] 实现门店收货地址维护

### 任务3.2：物料浏览模块（需求3）
- [ ] 实现物料分类列表和搜索接口
- [ ] 实现物料详情和区域供应商过滤
- [ ] 实现多供应商报价对比和加价后价格计算

### 任务3.3：购物车模块（需求4）
- [ ] 实现购物车增删改查接口（Redis存储）
- [ ] 实现按供应商分组和小计计算
- [ ] 实现起送价和起订量校验逻辑

### 任务3.4：门店市场行情模块（需求21）
- [ ] 实现市场行情列表接口
- [ ] 实现供应商显示名称转换和加价后价格显示
- [ ] 实现最低价标识、分类筛选和搜索

---

## 阶段四：订单与支付（第7-9周）

### 任务4.1：结算与下单模块（需求5）
- [ ] 实现购物车结算和订单拆分逻辑
- [ ] 实现订单创建、配送日期计算、手续费计算

### 任务4.2：支付模块（需求5）
- [ ] 集成利楚扫呗支付 SDK
- [ ] 实现支付订单创建和二维码生成
- [ ] 实现支付状态查询、回调处理、超时取消
- [ ] 实现退款接口

### 任务4.3：订单管理-门店端（需求6）
- [ ] 实现门店订单列表、筛选、详情接口
- [ ] 实现再次购买功能
- [ ] 实现订单取消（1小时内）和取消申请

### 任务4.4：订单管理-供应商端（需求7）
- [ ] 实现供应商订单列表和状态更新接口
- [ ] 实现订单导出 Excel 和送货单打印
- [ ] 实现快递单号上传

### 任务4.5：订单管理-管理员端（需求8）
- [ ] 实现全局订单列表和多维度筛选
- [ ] 实现取消申请审批和订单恢复
- [ ] 实现管理员直接取消订单

---

## 阶段五：加价与通知（第10-11周）

### 任务5.1：加价管理模块（需求13）
- [ ] 实现多级加价开关（全局/供应商/门店/分类）
- [ ] 实现加价规则 CRUD 和优先级计算
- [ ] 实现加价价格计算服务
- [ ] 实现批量导入、预览模拟、收入报表

### 任务5.2：企业微信Webhook模块（需求14）
- [ ] 实现 Webhook URL 配置和消息模板
- [ ] 实现订单创建、状态变更、取消/恢复推送
- [ ] 实现推送开关、测试推送、重试机制（3次/5分钟）
- [ ] 实现推送日志和失败告警

### 任务5.3：供应商API对接模块（需求15）
- [ ] 实现 API 接口配置和订单推送
- [ ] 实现 HMAC-SHA256 签名和状态回调
- [ ] 实现重试策略和推送日志

### 任务5.4：供应商市场行情模块（需求20）
- [ ] 实现供应商市场行情列表（仅自己经营的产品）
- [ ] 实现市场最低价和价格竞争力状态
- [ ] 隐藏竞争对手数量和独家供应信息

---

## 阶段六：报表与系统设置（第12周）

### 任务6.1：数据统计与报表模块（需求16）
- [ ] 实现数据看板和订单状态分布
- [ ] 实现订货趋势图、排行榜、TOP10
- [ ] 实现多维度汇总报表和同比/环比分析
- [ ] 实现报表导出和定时生成

### 任务6.2：系统设置模块（需求18）
- [ ] 实现支付参数、超时时间、手续费率配置
- [ ] 实现送货单打印模板配置
- [ ] 实现操作日志记录和查询

---

## 阶段七：前端开发（第13-16周）

### 任务7.1：Web管理后台-管理员端
- [ ] 登录、角色选择、数据看板页面
- [ ] 订单管理、取消审批、供应商管理页面
- [ ] 供应商代管、配送设置审核、门店管理页面
- [ ] 物料管理、产品审核、素材库页面
- [ ] 加价管理、Webhook配置、报表、系统设置页面

### 任务7.2：Web管理后台-门店端
- [ ] 物料浏览、搜索、详情页面
- [ ] 购物车、结算、支付页面
- [ ] 订单列表、详情、市场行情页面

### 任务7.3：Web管理后台-供应商端
- [ ] 订单列表、处理、送货单打印页面
- [ ] 配送设置、起订量规则、产品管理页面
- [ ] 市场行情页面

---

## 阶段八：移动端APP开发（第17-20周）

### 任务8.1：移动端APP-门店端（需求19）
- [ ] 登录、首页、物料搜索、详情页面
- [ ] 购物车、结算、支付页面
- [ ] 订单列表、详情、市场行情、个人中心页面

### 任务8.2：移动端APP-供应商端（需求19）
- [ ] 首页、订单列表、详情、处理页面
- [ ] 配送设置、起订量规则、市场行情页面

### 任务8.3：移动端APP-管理员端（需求19）
- [ ] 首页、订单监控、取消审批、异常提醒页面

### 任务8.4：APP通用功能（需求19）
- [ ] 版本检查、热更新、强制更新
- [ ] 角色自动识别与切换
- [ ] 打包生成 Android APK

---

## 阶段九：测试与部署（第21-22周）

### 任务9.1：测试
- [ ] 单元测试（覆盖率 > 80%）
- [ ] 属性测试（验证24个正确性属性）
- [ ] 集成测试、E2E测试
- [ ] 性能测试、安全测试

### 任务9.2：部署
- [ ] 配置生产环境（MySQL主从、Redis集群、Nginx、SSL）
- [ ] 配置日志收集和监控告警
- [ ] 部署后端服务和前端资源
- [ ] 发布 Android APK

---

## 里程碑

| 里程碑 | 时间 | 交付物 |
|--------|------|--------|
| M1: 基础架构 | 第2周 | 项目框架、数据库、认证模块 |
| M2: 核心业务 | 第6周 | 物料、供应商、门店、购物车 |
| M3: 订单流程 | 第9周 | 订单、支付、状态流转 |
| M4: 增值功能 | 第12周 | 加价、通知、报表 |
| M5: Web端 | 第16周 | 管理后台三端 |
| M6: APP端 | 第20周 | 移动端APP三端 |
| M7: 上线 | 第22周 | 系统正式运行 |

---

## 优先级

- **P0（必须）**：认证、物料、购物车、订单、支付
- **P1（重要）**：加价、Webhook、供应商管理、门店管理
- **P2（一般）**：报表、素材库、API对接
- **P3（可选）**：手机验证码登录、定时报表、热更新
