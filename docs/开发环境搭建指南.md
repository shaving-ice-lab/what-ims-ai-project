# 供应链订货系统 - 开发环境搭建指南

## 前置要求

### 1. 系统要求
- **操作系统**: Windows 10/11, macOS 10.15+, Ubuntu 20.04+
- **内存**: 8GB RAM (推荐16GB)
- **硬盘**: 20GB可用空间

### 2. 必需软件

#### 2.1 Node.js
- 版本要求: 18.x LTS 或更高
- 下载地址: https://nodejs.org/
- 验证安装:
  ```bash
  node -v  # 应显示 v18.x.x 或更高
  npm -v   # 应显示 9.x.x 或更高
  ```

#### 2.2 Go
- 版本要求: 1.21 或更高
- 下载地址: https://golang.org/dl/
- 验证安装:
  ```bash
  go version  # 应显示 go1.21.x 或更高
  ```

#### 2.3 pnpm
- 版本要求: 8.x
- 安装命令:
  ```bash
  npm install -g pnpm@8
  ```
- 验证安装:
  ```bash
  pnpm -v  # 应显示 8.x.x
  ```

#### 2.4 Git
- 下载地址: https://git-scm.com/
- 验证安装:
  ```bash
  git --version
  ```

#### 2.5 MySQL
- 版本要求: 8.0
- 下载地址: https://dev.mysql.com/downloads/
- 默认配置:
  - 端口: 3306
  - 用户名: root
  - 密码: 自定义

#### 2.6 Redis
- 版本要求: 7.x
- 下载地址: https://redis.io/download
- Windows用户可使用: https://github.com/microsoftarchive/redis/releases
- 默认配置:
  - 端口: 6379
  - 密码: 可选

## 项目初始化

### 1. 克隆项目
```bash
git clone https://github.com/your-org/what-ims-ai-project.git
cd what-ims-ai-project
```

### 2. 安装依赖

#### 2.1 前端依赖安装
```bash
# 在项目根目录执行
pnpm install
```

#### 2.2 后端依赖安装
```bash
cd apps/backend
go mod download
```

### 3. 环境配置

#### 3.1 前端环境配置

1. **Web应用环境变量**
   ```bash
   cd apps/web
   cp env.template .env.development
   ```
   编辑 `.env.development` 文件，配置以下内容：
   ```env
   NEXT_PUBLIC_API_BASE_URL=http://localhost:8080/api
   NEXT_PUBLIC_WS_URL=ws://localhost:8080/ws
   ```

2. **移动端应用环境变量**
   ```bash
   cd apps/mobile
   cp config/dev.js.template config/dev.js
   ```

#### 3.2 后端环境配置

1. **创建配置文件**
   ```bash
   cd apps/backend
   cp config.example.yaml config.yaml
   ```

2. **编辑配置文件** `config.yaml`:
   ```yaml
   server:
     port: 8080
     mode: development

   database:
     driver: mysql
     host: localhost
     port: 3306
     username: root
     password: your_password
     database: supply_chain_db
     charset: utf8mb4

   redis:
     host: localhost
     port: 6379
     password: ""
     db: 0

   jwt:
     secret: your_jwt_secret_key
     expire: 7200  # 2 hours
     refresh_expire: 604800  # 7 days
   ```

### 4. 数据库初始化

#### 4.1 创建数据库
```sql
CREATE DATABASE IF NOT EXISTS supply_chain_db CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;
```

#### 4.2 运行数据库迁移
```bash
cd apps/backend
go run main.go migrate
```

#### 4.3 导入初始数据（可选）
```bash
mysql -u root -p supply_chain_db < database/seeds/init.sql
```

## 启动项目

### 1. 启动后端服务
```bash
cd apps/backend
go run main.go

# 或使用 Air 进行热重载开发
air
```
服务将运行在: http://localhost:8080

### 2. 启动Web前端
```bash
cd apps/web
pnpm dev
```
应用将运行在: http://localhost:3000

### 3. 启动移动端应用

#### 3.1 H5模式
```bash
cd apps/mobile
pnpm dev:h5
```
H5应用将运行在: http://localhost:10086

#### 3.2 微信小程序模式
```bash
cd apps/mobile
pnpm dev:weapp
```
然后使用微信开发者工具打开 `apps/mobile/dist` 目录

#### 3.3 React Native模式（APP）
```bash
cd apps/mobile
pnpm dev:rn
```

### 4. 使用Turbo同时启动所有服务
在项目根目录执行：
```bash
pnpm dev
```
这将同时启动所有应用和服务。

## 开发工具配置

### 1. VSCode配置

安装推荐插件：
- 打开VSCode
- 进入扩展面板
- 搜索 `@recommended`
- 安装所有推荐的扩展

### 2. Git配置

配置Git用户信息：
```bash
git config --global user.name "Your Name"
git config --global user.email "your.email@example.com"
```

配置提交规范：
```bash
# 项目已配置husky和commitlint，提交信息需遵循规范
# 格式: <type>: <subject>
# 例如: feat: 添加登录功能
```

### 3. 代码规范

项目已配置ESLint和Prettier，提交前会自动检查和格式化代码。

手动运行检查：
```bash
# 检查代码规范
pnpm lint

# 格式化代码
pnpm format
```

## API文档

### 1. Swagger文档
后端启动后访问: http://localhost:8080/swagger/index.html

### 2. Postman集合
导入 `docs/postman/supply-chain-api.json` 到Postman中使用。

## 常见问题

### Q1: pnpm install报错
**解决方案**:
1. 清除缓存: `pnpm store prune`
2. 删除node_modules: `rm -rf node_modules`
3. 重新安装: `pnpm install`

### Q2: 数据库连接失败
**解决方案**:
1. 检查MySQL服务是否启动
2. 确认用户名密码是否正确
3. 检查防火墙设置

### Q3: 端口被占用
**解决方案**:
1. 查找占用端口的进程:
   - Windows: `netstat -ano | findstr :端口号`
   - Mac/Linux: `lsof -i :端口号`
2. 结束进程或更改应用端口配置

### Q4: Go依赖下载慢
**解决方案**:
配置Go代理:
```bash
go env -w GO111MODULE=on
go env -w GOPROXY=https://goproxy.cn,direct
```

### Q5: 前端页面空白
**解决方案**:
1. 检查控制台错误信息
2. 确认API服务是否正常运行
3. 检查环境变量配置是否正确

## 技术支持

- 项目文档: `/docs`
- 技术选型报告: `/docs/技术选型报告.md`
- 开发TodoList: `/docs/ims-development-todolist.md`
- 系统设计文档: `/docs/供应链系统设计文档.md`

## 版本更新

定期执行以下命令更新依赖:
```bash
# 更新前端依赖
pnpm update

# 更新后端依赖
cd apps/backend
go get -u ./...
go mod tidy
```

---

**文档版本**: v1.0  
**更新日期**: 2024-12-29  
**维护团队**: 技术开发组
